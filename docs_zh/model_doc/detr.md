<!--ç‰ˆæƒæ‰€æœ‰2021å¹´HuggingFaceå›¢é˜Ÿã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚

æ ¹æ®Apacheè®¸å¯è¯ç¬¬2ç‰ˆï¼ˆâ€œè®¸å¯è¯â€ï¼‰çš„è§„å®šï¼Œé™¤éç¬¦åˆè®¸å¯è¯çš„è§„å®šï¼Œå¦åˆ™ä¸å¾—ä½¿ç”¨æ­¤æ–‡ä»¶ã€‚
æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®è·å¾—è®¸å¯è¯çš„å‰¯æœ¬

http://www.apache.org/licenses/LICENSE-2.0

é™¤éé€‚ç”¨æ³•å¾‹è¦æ±‚æˆ–ä¹¦é¢åŒæ„ï¼Œåœ¨è®¸å¯è¯ä¸‹åˆ†å‘çš„è½¯ä»¶æ˜¯æŒ‰
â€œæŒ‰åŸæ ·â€åŸºç¡€åˆ†å‘çš„ï¼Œæ²¡æœ‰ä»»ä½•å½¢å¼çš„æ˜ç¤ºæˆ–æš—ç¤ºçš„æ‹…ä¿æˆ–æ¡ä»¶ã€‚
è¯·å‚é˜…è®¸å¯è¯ä»¥è·å–æƒé™å’Œé™åˆ¶çš„ç‰¹å®šè¯­è¨€ã€‚

âš ï¸ è¯·æ³¨æ„ï¼Œæ­¤æ–‡ä»¶æ˜¯Markdownæ ¼å¼ï¼Œä½†åŒ…å«ç‰¹å®šäºæˆ‘ä»¬çš„doc-builderï¼ˆç±»ä¼¼äºMDXï¼‰çš„è¯­æ³•ï¼Œå¯èƒ½åœ¨MarkdownæŸ¥çœ‹å™¨ä¸­æ— æ³•æ­£ç¡®æ˜¾ç¤ºã€‚

-->

# DETR

è¯¦ç»†ä¿¡æ¯

DETRæ¨¡å‹æ˜¯ç”±Nicolas Carionã€Francisco Massaã€Gabriel Synnaeveã€Nicolas Usunierã€Alexander Kirillovå’ŒSergey Zagoruykoåœ¨ã€Šä½¿ç”¨Transformerçš„ç«¯åˆ°ç«¯ç›®æ ‡æ£€æµ‹ã€‹ï¼ˆhttps://arxiv.org/abs/2005.12872ï¼‰ä¸­æå‡ºçš„ã€‚DETRç”±ä¸€ä¸ªå·ç§¯éª¨å¹²ç½‘ç»œå’Œä¸€ä¸ªç¼–ç å™¨-è§£ç å™¨Transformerç»„æˆï¼Œå¯ç”¨äºè¿›è¡Œç«¯åˆ°ç«¯çš„ç›®æ ‡æ£€æµ‹è®­ç»ƒã€‚å®ƒæå¤§åœ°ç®€åŒ–äº†åƒFaster-R-CNNå’ŒMask-R-CNNè¿™æ ·çš„æ¨¡å‹çš„å¤æ‚æ€§ï¼Œè¿™äº›æ¨¡å‹ä½¿ç”¨äº†åŒºåŸŸæè®®ã€éæœ€å¤§æŠ‘åˆ¶è¿‡ç¨‹å’Œé”šç‚¹ç”Ÿæˆç­‰æŠ€æœ¯ã€‚æ­¤å¤–ï¼Œé€šè¿‡åœ¨è§£ç å™¨è¾“å‡ºä¹‹ä¸Šç®€å•åœ°æ·»åŠ ä¸€ä¸ªæ©ç å¤´ï¼ŒDETRè¿˜å¯ä»¥è‡ªç„¶åœ°æ‰©å±•åˆ°æ‰§è¡Œå…¨æ™¯åˆ†å‰²ã€‚

è®ºæ–‡çš„æ‘˜è¦å¦‚ä¸‹ï¼š

æˆ‘ä»¬æå‡ºäº†ä¸€ç§å°†ç›®æ ‡æ£€æµ‹è§†ä¸ºç›´æ¥é›†åˆé¢„æµ‹é—®é¢˜çš„æ–°æ–¹æ³•ã€‚æˆ‘ä»¬çš„æ–¹æ³•ç®€åŒ–äº†æ£€æµ‹æµç¨‹ï¼Œæœ‰æ•ˆåœ°æ¶ˆé™¤äº†è®¸å¤šæ‰‹åŠ¨è®¾è®¡çš„ç»„ä»¶ï¼Œä¾‹å¦‚éæœ€å¤§æŠ‘åˆ¶è¿‡ç¨‹æˆ–æ˜ç¡®ç¼–ç æˆ‘ä»¬å¯¹ä»»åŠ¡çš„å…ˆéªŒçŸ¥è¯†çš„é”šç‚¹ç”Ÿæˆã€‚æ–°æ¡†æ¶DEtection TRansformeræˆ–DETRçš„ä¸»è¦ç»„æˆéƒ¨åˆ†æ˜¯å¼ºåˆ¶å”¯ä¸€é¢„æµ‹çš„åŸºäºé›†åˆçš„å…¨å±€æŸå¤±ï¼Œé€šè¿‡äºŒéƒ¨å›¾åŒ¹é…ï¼Œä»¥åŠä¸€ç§transformerç¼–ç å™¨-è§£ç å™¨æ¶æ„ã€‚ç»™å®šä¸€ç»„å›ºå®šçš„å­¦ä¹ å¯¹è±¡æŸ¥è¯¢ï¼ŒDETRé€šè¿‡æ¨ç†å¯¹è±¡ä¹‹é—´çš„å…³ç³»å’Œå…¨å±€å›¾åƒä¸Šä¸‹æ–‡ï¼Œç›´æ¥è¾“å‡ºæœ€ç»ˆçš„é¢„æµ‹é›†ã€‚è¿™ä¸ªæ–°æ¨¡å‹åœ¨æ¦‚å¿µä¸Šå¾ˆç®€å•ï¼Œä¸éœ€è¦ä¸“é—¨çš„åº“ï¼Œä¸åƒè®¸å¤šå…¶ä»–ç°ä»£æ£€æµ‹å™¨é‚£æ ·ã€‚DETRåœ¨å…·æœ‰æŒ‘æˆ˜æ€§çš„COCOç›®æ ‡æ£€æµ‹æ•°æ®é›†ä¸Šå±•ç¤ºäº†ä¸é«˜åº¦ä¼˜åŒ–çš„Faster RCNNåŸºçº¿ç›¸å½“çš„å‡†ç¡®æ€§å’Œè¿è¡Œæ—¶æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒDETRå¯ä»¥è¢«è½»æ¾åœ°æ¨å¹¿åˆ°ä»¥ç»Ÿä¸€çš„æ–¹å¼äº§ç”Ÿå…¨æ™¯åˆ†å‰²ã€‚æˆ‘ä»¬è¯æ˜äº†å®ƒåœ¨ç«äº‰åŸºçº¿ä¸Šæ˜æ˜¾ä¼˜äºç«äº‰åŸºçº¿ã€‚

è¯¥æ¨¡å‹ç”±nielsrè´¡çŒ®ï¼ˆhttps://huggingface.co/nielsrï¼‰ã€‚åŸå§‹ä»£ç å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°ï¼ˆhttps://github.com/facebookresearch/detrï¼‰ã€‚

ä¸‹é¢æ˜¯æœ‰å…³[`~transformers.DetrForObjectDetection`]å·¥ä½œåŸç†çš„TLDRï¼š

é¦–å…ˆï¼Œå°†å›¾åƒå‘é€åˆ°é¢„è®­ç»ƒçš„å·ç§¯éª¨å¹²ç½‘ç»œï¼ˆåœ¨è®ºæ–‡ä¸­ï¼Œä½œè€…ä½¿ç”¨ResNet-50/ResNet-101ï¼‰ã€‚å‡è®¾æˆ‘ä»¬è¿˜æ·»åŠ äº†ä¸€ä¸ªæ‰¹å¤„ç†ç»´åº¦ã€‚è¿™æ„å‘³ç€éª¨å¹²ç½‘ç»œçš„è¾“å…¥æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º`(batch_size, 3, height, width)`çš„å¼ é‡ï¼Œå‡è®¾å›¾åƒå…·æœ‰3ä¸ªé¢œè‰²é€šé“ï¼ˆRGBï¼‰ã€‚CNNéª¨å¹²ç½‘ç»œè¾“å‡ºä¸€ä¸ªæ–°çš„è¾ƒä½åˆ†è¾¨ç‡çš„ç‰¹å¾å›¾ï¼Œé€šå¸¸å½¢çŠ¶ä¸º`(batch_size, 2048, height/32, width/32)`ã€‚ç„¶åï¼Œä½¿ç”¨`nn.Conv2D`å±‚å°†å…¶æŠ•å½±åˆ°DETR Transformerçš„éšè—ç»´åº¦ï¼Œè¯¥ç»´åº¦é»˜è®¤ä¸º`256`ã€‚å› æ­¤ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå½¢çŠ¶ä¸º`(batch_size, 256, height/32, width/32)`çš„å¼ é‡ã€‚æ¥ä¸‹æ¥ï¼Œå°†ç‰¹å¾å›¾å±•å¹³å’Œè½¬ç½®ï¼Œä»¥è·å¾—å½¢çŠ¶ä¸º`(batch_size, seq_len, d_model)` =`(batch_size, width/32*height/32, 256)`çš„å¼ é‡ã€‚å› æ­¤ï¼Œä¸NLPæ¨¡å‹ä¸åŒï¼Œåºåˆ—é•¿åº¦å®é™…ä¸Šæ¯”é€šå¸¸ä½¿ç”¨æ›´å°çš„`d_model`ï¼ˆåœ¨NLPä¸­é€šå¸¸ä¸º768æˆ–æ›´é«˜ï¼‰æ›´é•¿ã€‚

æ¥ä¸‹æ¥ï¼Œå°†å…¶å‘é€åˆ°ç¼–ç å™¨ï¼Œè¾“å‡ºå½¢çŠ¶ç›¸åŒçš„`encoder_hidden_states`ï¼ˆå¯ä»¥å°†å…¶è§†ä¸ºå›¾åƒç‰¹å¾ï¼‰ã€‚æ¥ä¸‹æ¥ï¼Œæ‰€è°“çš„**å¯¹è±¡æŸ¥è¯¢**è¢«å‘é€åˆ°è§£ç å™¨ã€‚è¿™æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º`(batch_size, num_queries, d_model)`çš„å¼ é‡ï¼Œå…¶ä¸­`num_queries`é€šå¸¸è®¾ç½®ä¸º100ï¼Œå¹¶ä¸”ç”¨é›¶åˆå§‹åŒ–ã€‚è¿™äº›è¾“å…¥åµŒå…¥æ˜¯ä½ç½®ç¼–ç ï¼Œä½œè€…å°†å…¶ç§°ä¸ºå¯¹è±¡æŸ¥è¯¢ï¼Œå¹¶ä¸”ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œå®ƒä»¬è¢«æ·»åŠ åˆ°æ¯ä¸ªå…³æ³¨å±‚çš„è¾“å…¥ä¸­ã€‚æ¯ä¸ªå¯¹è±¡æŸ¥è¯¢å°†åœ¨å›¾åƒä¸­å¯»æ‰¾ç‰¹å®šå¯¹è±¡ã€‚è§£ç å™¨é€šè¿‡å¤šä¸ªè‡ªæ³¨æ„åŠ›å’Œç¼–ç å™¨-è§£ç å™¨æ³¨æ„åŠ›å±‚æ¥æ›´æ–°è¿™äº›åµŒå…¥ï¼Œå¹¶è¾“å‡ºç›¸åŒå½¢çŠ¶çš„`decoder_hidden_states`ï¼š`(batch_size, num_queries, d_model)`ã€‚æ¥ä¸‹æ¥ï¼Œä¸ºç›®æ ‡æ£€æµ‹æ·»åŠ äº†ä¸¤ä¸ªå¤´ï¼šä¸€ä¸ªçº¿æ€§å±‚ï¼Œç”¨äºå°†æ¯ä¸ªå¯¹è±¡æŸ¥è¯¢åˆ†ç±»ä¸ºå¯¹è±¡ä¹‹ä¸€æˆ–â€œæ²¡æœ‰å¯¹è±¡â€ï¼Œä»¥åŠä¸€ä¸ªMLPï¼Œç”¨äºé¢„æµ‹æ¯ä¸ªæŸ¥è¯¢çš„è¾¹ç•Œæ¡†ã€‚

æ¨¡å‹ä½¿ç”¨**äºŒéƒ¨å›¾åŒ¹é…æŸå¤±**è¿›è¡Œè®­ç»ƒï¼šå®é™…ä¸Šï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†æ¯ä¸ªN=100ä¸ªå¯¹è±¡æŸ¥è¯¢çš„é¢„æµ‹ç±»åˆ«+è¾¹ç•Œæ¡†ä¸åœ°é¢å®å†µæ³¨é‡Šçš„é•¿åº¦Nï¼ˆå› æ­¤ï¼Œå¦‚æœå›¾åƒåªåŒ…å«4ä¸ªå¯¹è±¡ï¼Œåˆ™96ä¸ªæ³¨é‡Šå°†åªæœ‰ä¸€ä¸ªâ€œæ— å¯¹è±¡â€ä½œä¸ºç±»åˆ«å’Œä¸€ä¸ªâ€œæ— è¾¹ç•Œæ¡†â€ä½œä¸ºè¾¹ç•Œæ¡†ï¼‰ã€‚ä½¿ç”¨åŒˆç‰™åˆ©åŒ¹é…ç®—æ³•å¯»æ‰¾æ¯ä¸ªNæŸ¥è¯¢ä¸æ¯ä¸ªNæ³¨é‡Šçš„æœ€ä½³ä¸€å¯¹ä¸€æ˜ å°„ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨æ ‡å‡†äº¤å‰ç†µï¼ˆç”¨äºç±»åˆ«ï¼‰å’ŒL1æŸå¤±çš„çº¿æ€§ç»„åˆä»¥åŠ[å¹¿ä¹‰IoUæŸå¤±]ï¼ˆhttps://giou.stanford.edu/ï¼‰ï¼ˆç”¨äºè¾¹ç•Œæ¡†ï¼‰æ¥ä¼˜åŒ–æ¨¡å‹çš„å‚æ•°ã€‚

DETRå¯ä»¥è‡ªç„¶åœ°æ‰©å±•ä»¥æ‰§è¡Œå…¨æ™¯åˆ†å‰²ï¼ˆå°†è¯­ä¹‰åˆ†å‰²å’Œå®ä¾‹åˆ†å‰²ç»Ÿä¸€èµ·æ¥ï¼‰ã€‚[`~transformers.DetrForSegmentation`]åœ¨[`~transformers.DetrForObjectDetection`]ä¸Šæ–¹æ·»åŠ äº†ä¸€ä¸ªåˆ†å‰²æ©ç å¤´ã€‚å¯ä»¥åŒæ—¶è®­ç»ƒæ©ç å¤´ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªä¸¤æ­¥è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆè®­ç»ƒ[`~transformers.DetrForObjectDetection`]æ¨¡å‹æ¥æ£€æµ‹â€œç‰©ä½“â€ï¼ˆå®ä¾‹ï¼‰å’Œâ€œç‰©ä½“â€å‘¨å›´çš„è¾¹ç•Œæ¡†ï¼ˆèƒŒæ™¯ç‰©ä½“ï¼Œå¦‚æ ‘æœ¨ï¼Œé“è·¯ï¼Œå¤©ç©ºï¼‰ï¼Œç„¶åå†»ç»“æ‰€æœ‰æƒé‡ï¼Œä»…è®­ç»ƒæ©ç å¤´25ä¸ªæ—¶æœŸã€‚å®éªŒè¯æ˜ï¼Œè¿™ä¸¤ç§æ–¹æ³•çš„ç»“æœç›¸ä¼¼ã€‚è¯·æ³¨æ„ï¼Œé¢„æµ‹æ¡†æ˜¯è®­ç»ƒå¯èƒ½ï¼Œå› ä¸ºåŒˆç‰™åˆ©åŒ¹é…æ˜¯ä½¿ç”¨æ¡†è·ç¦»è®¡ç®—çš„ã€‚

æç¤ºï¼š

- DETRä½¿ç”¨æ‰€è°“çš„**å¯¹è±¡æŸ¥è¯¢**æ¥æ£€æµ‹å›¾åƒä¸­çš„å¯¹è±¡ã€‚æŸ¥è¯¢çš„æ•°é‡å†³å®šäº†å¯ä»¥åœ¨å•ä¸ªå›¾åƒä¸­æ£€æµ‹åˆ°çš„æœ€å¤§å¯¹è±¡æ•°ï¼Œé»˜è®¤è®¾ç½®ä¸º100ï¼ˆè¯·å‚è§[`~transformers.DetrConfig`]çš„`num_queries`å‚æ•°ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæœ€å¥½æœ‰ä¸€äº›é¢„ç•™ç©ºé—´ï¼ˆåœ¨COCOä¸­ï¼Œä½œè€…ä½¿ç”¨äº†100ï¼Œè€ŒCOCOå›¾åƒä¸­çš„æœ€å¤§å¯¹è±¡æ•°ä¸º~70ï¼‰ã€‚
- DETRçš„è§£ç å™¨å¹¶è¡Œåœ°æ›´æ–°æŸ¥è¯¢åµŒå…¥ã€‚è¿™ä¸ä½¿ç”¨è‡ªå›å½’è§£ç è€Œä¸æ˜¯å¹¶è¡Œè§£ç çš„è¯­è¨€æ¨¡å‹ï¼ˆä¾‹å¦‚GPT-2ï¼‰ä¸åŒã€‚å› æ­¤ï¼Œä¸ä½¿ç”¨å› æœå…³æ³¨è’™ç‰ˆã€‚
- DETRåœ¨æŸ¥è¯¢å’Œé”®è¿›è¡ŒæŠ•å½±ä¹‹å‰ï¼Œåœ¨æ¯ä¸ªè‡ªæ³¨æ„å’Œäº¤å‰æ³¨æ„å±‚çš„éšè—çŠ¶æ€ä¸­æ·»åŠ ä½ç½®åµŒå…¥ã€‚å¯¹äºå›¾åƒçš„ä½ç½®åµŒå…¥ï¼Œå¯ä»¥é€‰æ‹©å›ºå®šçš„æ­£å¼¦æˆ–å­¦ä¹ çš„ç»å¯¹ä½ç½®åµŒå…¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ[`~transformers.DetrConfig`]çš„`position_embedding_type`å‚æ•°è®¾ç½®ä¸º`sine`ã€‚
- åœ¨è®­ç»ƒæœŸé—´ï¼ŒDETRçš„ä½œè€…å‘ç°åœ¨è§£ç å™¨ä¸­ä½¿ç”¨è¾…åŠ©æŸå¤±å¯¹äºå¸®åŠ©æ¨¡å‹è¾“å‡ºæ¯ä¸ªç±»åˆ«çš„æ­£ç¡®æ•°é‡éå¸¸æœ‰å¸®åŠ©ã€‚å¦‚æœå°†[`~transformers.DetrConfig`]çš„`auxiliary_loss`å‚æ•°è®¾ç½®ä¸º`True`ï¼Œåˆ™åœ¨æ¯ä¸ªè§£ç å™¨å±‚ä¹‹åæ·»åŠ é¢„æµ‹å‰é¦ˆç¥ç»ç½‘ç»œå’ŒåŒˆç‰™åˆ©æŸå¤±ï¼ˆFFNå…±äº«å‚æ•°ï¼‰ã€‚
- å¦‚æœè¦åœ¨å¤šä¸ªèŠ‚ç‚¹çš„åˆ†å¸ƒç¯å¢ƒä¸­è®­ç»ƒæ¨¡å‹ï¼Œåº”è¯¥åœ¨modeling_detr.pyçš„DetrLossç±»ä¸­æ›´æ–°_num_boxes_å˜é‡ã€‚å½“åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œè®­ç»ƒæ—¶ï¼Œåº”å°†å…¶è®¾ç½®ä¸ºæ‰€æœ‰èŠ‚ç‚¹ä¸Šå¹³å‡ç›®æ ‡æ¡†çš„æ•°é‡ï¼Œå¯ä»¥åœ¨åŸå§‹å®ç°[here](https://github.com/facebookresearch/detr/blob/a54b77800eb8e64e3ad0d8237789fcbf2f8350c5/models/detr.py#L227-L232)ä¸­æ‰¾åˆ°ã€‚
- [`~transformers.DetrForObjectDetection`]å’Œ[`~transformers.DetrForSegmentation`]å¯ä»¥ä½¿ç”¨[timmåº“](https://github.com/rwightman/pytorch-image-models)ä¸­å¯ç”¨çš„ä»»ä½•å·ç§¯éª¨å¹²ç½‘ç»œè¿›è¡Œåˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡å°†[`~transformers.DetrConfig`]çš„`backbone`å±æ€§è®¾ç½®ä¸º`"tf_mobilenetv3_small_075"`ï¼Œç„¶åä½¿ç”¨è¯¥é…ç½®åˆå§‹åŒ–æ¨¡å‹æ¥ä½¿ç”¨MobileNetéª¨å¹²ç½‘ã€‚
- DETRè°ƒæ•´è¾“å…¥å›¾åƒçš„å¤§å°ï¼Œä½¿æœ€çŸ­è¾¹è‡³å°‘æœ‰ä¸€å®šæ•°é‡çš„åƒç´ ï¼Œè€Œæœ€é•¿è¾¹è‡³å¤šä¸º1333åƒç´ ã€‚åœ¨è®­ç»ƒæ—¶ï¼Œä½¿ç”¨ç¼©æ”¾å¢å¼ºæ¥éšæœºå°†æœ€çŸ­è¾¹è®¾ç½®ä¸ºè‡³å°‘480åƒç´ ï¼Œæœ€å¤š800åƒç´ ã€‚åœ¨æ¨ç†æ—¶é—´ï¼Œæœ€çŸ­è¾¹è¢«è®¾ç½®ä¸º800ã€‚å¯ä»¥ä½¿ç”¨[`~transformers.DetrImageProcessor`]ä¸ºæ¨¡å‹å‡†å¤‡å›¾åƒï¼ˆå’Œå¯é€‰çš„COCOæ ¼å¼çš„æ³¨é‡Šï¼‰ã€‚ç”±äºè¿™ç§è°ƒæ•´å¤§å°ï¼Œæ‰¹å¤„ç†ä¸­çš„å›¾åƒå¤§å°å¯èƒ½ä¸åŒã€‚DETRé€šè¿‡å°†å›¾åƒå¡«å……åˆ°æ‰¹å¤„ç†ä¸­çš„æœ€å¤§å¤§å°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªåƒç´ æ©ç æ¥æŒ‡ç¤ºå“ªäº›åƒç´ æ˜¯å®é™…çš„/å“ªäº›æ˜¯å¡«å……æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ–è€…ï¼Œæ‚¨è¿˜å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„`collate_fn`ï¼Œä»¥ä¾¿ä½¿ç”¨[`~transformers.DetrImageProcessor.pad_and_create_pixel_mask`]å°†å›¾åƒæ‰¹å¤„ç†åœ¨ä¸€èµ·ã€‚
- å›¾åƒçš„å¤§å°å°†å†³å®šä½¿ç”¨çš„å†…å­˜é‡ï¼Œå¹¶å› æ­¤å†³å®š`batch_size`ã€‚å»ºè®®æ¯ä¸ªGPUä½¿ç”¨2ä¸ªbatchå¤§å°ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[æ­¤Githubçº¿ç¨‹](https://github.com/facebookresearch/detr/issues/150)ã€‚

æœ‰ä¸‰ç§å®ä¾‹åŒ–DETRæ¨¡å‹çš„æ–¹æ³•ï¼ˆå–å†³äºæ‚¨çš„é¦–é€‰ï¼‰ï¼š

é€‰é¡¹1ï¼šä½¿ç”¨é¢„è®­ç»ƒæƒé‡å®ä¾‹åŒ–æ•´ä¸ªæ¨¡å‹çš„DETR
```py
>>> from transformers import DetrForObjectDetection

>>> model = DetrForObjectDetection.from_pretrained("facebook/detr-resnet-50")
```

é€‰é¡¹2ï¼šä½¿ç”¨Transformerçš„éšæœºåˆå§‹åŒ–æƒé‡ï¼Œä½†ä½¿ç”¨éª¨å¹²ç½‘ç»œçš„é¢„è®­ç»ƒæƒé‡å®ä¾‹åŒ–DETR
```py
>>> from transformers import DetrConfig, DetrForObjectDetection

>>> config = DetrConfig()
>>> model = DetrForObjectDetection(config)
```
é€‰é¡¹3ï¼šä½¿ç”¨éšæœºåˆå§‹åŒ–æƒé‡çš„éª¨å¹²ç½‘ç»œ+ Transformerå®ä¾‹åŒ–DETR
```py
>>> config = DetrConfig(use_pretrained_backbone=False)
>>> model = DetrForObjectDetection(config)
```

æ€»ä¹‹ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹è¡¨æ ¼ï¼š

| ä»»åŠ¡| ç›®æ ‡æ£€æµ‹| å®ä¾‹åˆ†å‰²| å…¨æ™¯åˆ†å‰²|
|---------|----------|-----------|-----------|
| **è¯´æ˜**| åœ¨å›¾åƒä¸­é¢„æµ‹å›´ç»•ç‰©ä½“çš„è¾¹ç•Œæ¡†å’Œç±»æ ‡ç­¾| åœ¨å›¾åƒä¸­é¢„æµ‹å›´ç»•ç‰©ä½“ï¼ˆå³å®ä¾‹ï¼‰çš„æ©ç | åœ¨å›¾åƒä¸­é¢„æµ‹å›´ç»•ç‰©ä½“ï¼ˆå³å®ä¾‹ï¼‰ä»¥åŠâ€œç‰©å“â€ï¼ˆå³èƒŒæ™¯ç‰©ä½“ï¼Œå¦‚æ ‘æœ¨å’Œé“è·¯ï¼‰çš„æ©ç |
| **æ¨¡å‹**| [`~transformers.DetrForObjectDetection`]| [`~transformers.DetrForSegmentation`]| [`~transformers.DetrForSegmentation`]|
| **ç¤ºä¾‹æ•°æ®é›†**| COCOæ£€æµ‹| COCOæ£€æµ‹ã€COCOå…¨æ™¯| COCOå…¨æ™¯  |                                                                  |
| **æä¾›ç»™**  [`~transformers.DetrImageProcessor`]çš„æ‰¹æ³¨æ ¼å¼| {'image_id': `int`, 'annotations': `List[Dict]`}ï¼Œæ¯ä¸ªå­—å…¸éƒ½æ˜¯COCOå¯¹è±¡æ³¨é‡Š  | {'image_id': `int`, 'annotations': `List[Dict]`}ï¼ˆåœ¨COCOæ£€æµ‹çš„æƒ…å†µä¸‹ï¼‰æˆ–{'file_name': `str`ï¼Œ'image_id': `int`ï¼Œ'segments_info': `List[Dict]`}ï¼ˆåœ¨COCOå…¨æ™¯çš„æƒ…å†µä¸‹ï¼‰| {'file_name': `str`, 'image_id': `int`, 'segments_info': `List[Dict]`ï¼Œmasks_pathï¼ˆæŒ‡å‘åŒ…å«æ©ç PNGæ–‡ä»¶çš„ç›®å½•çš„è·¯å¾„ï¼‰|
| **åå¤„ç†**ï¼ˆå³å°†æ¨¡å‹çš„è¾“å‡ºè½¬æ¢ä¸ºCOCO APIï¼‰| [`~transformers.DetrImageProcessor.post_process`] | [`~transformers.DetrImageProcessor.post_process_segmentation`] | [`~transformers.DetrImageProcessor.post_process_segmentation`]ï¼Œ[`~transformers.DetrImageProcessor.post_process_panoptic`] |
| **è¯„ä¼°å™¨** | `CocoEvaluator`ï¼Œ`iou_types="bbox"` | `CocoEvaluator`ï¼Œ`iou_types="bbox"`æˆ–`"segm"` | `CocoEvaluator`ï¼Œ`iou_tupes="bbox"`æˆ–`"segm"`ï¼Œ`PanopticEvaluator` |

ç®€è€Œè¨€ä¹‹ï¼Œåº”ä»¥COCOæ£€æµ‹æˆ–COCOå…¨æ™¯æ ¼å¼å‡†å¤‡æ•°æ®ï¼Œç„¶åä½¿ç”¨[`~transformers.DetrImageProcessor`]åˆ›å»º`pixel_values`ï¼Œ`pixel_mask`å’Œå¯é€‰çš„`labels`ï¼Œç„¶åç”¨äºè®­ç»ƒï¼ˆæˆ–å¾®è°ƒï¼‰æ¨¡å‹ã€‚å¯¹äºè¯„ä¼°ï¼Œåº”é¦–å…ˆä½¿ç”¨[`~transformers.DetrImageProcessor`]çš„å…¶ä¸­ä¸€ç§åå¤„ç†æ–¹æ³•å°†æ¨¡å‹çš„è¾“å‡ºè½¬æ¢ã€‚è¿™äº›å¯ä»¥æä¾›ç»™`CocoEvaluator`æˆ–`PanopticEvaluator`ï¼Œå…è®¸æ‚¨è®¡ç®—è¯¸å¦‚å‡å€¼å¹³å‡ç²¾åº¦ï¼ˆmAPï¼‰å’Œå…¨æ™¯è´¨é‡ï¼ˆPQï¼‰ä¹‹ç±»çš„æŒ‡æ ‡ã€‚åè€…å¯¹è±¡åœ¨[åŸå§‹å­˜å‚¨åº“](https://github.com/facebookresearch/detr)ä¸­å®ç°ã€‚æœ‰å…³è¯„ä¼°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[ç¤ºä¾‹ç¬”è®°æœ¬](https://github.com/NielsRogge/Transformers-Tutorials/tree/master/DETR)ã€‚

## èµ„æº

å®˜æ–¹Hugging Faceå’Œç¤¾åŒºï¼ˆç”±ğŸŒè¡¨ç¤ºï¼‰èµ„æºåˆ—è¡¨ï¼Œä»¥å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨DETRã€‚

<PipelineTag pipeline="object-detection"/>

- æ‰€æœ‰ç¤ºä¾‹ç¬”è®°æœ¬æ¼”ç¤ºäº†åœ¨è‡ªå®šä¹‰æ•°æ®é›†ä¸Šå¾®è°ƒ[`DetrForObjectDetection`]å’Œ[`DetrForSegmentation`]ï¼Œå¯ä»¥åœ¨[æ­¤å¤„](https://github.com/NielsRogge/Transformers-Tutorials/tree/master/DETR)æ‰¾åˆ°ã€‚
- å¦è¯·å‚é˜…ï¼š[å¯¹è±¡æ£€æµ‹ä»»åŠ¡æŒ‡å—](../tasks/object_detection)

å¦‚æœæ‚¨æœ‰å…´è¶£æäº¤ä¸€ä¸ªè¦åŒ…å«åœ¨è¿™é‡Œçš„èµ„æºï¼Œè¯·éšæ—¶æäº¤æ‹‰å–è¯·æ±‚ï¼Œæˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œå®¡æ ¸ï¼èµ„æºåº”ç†æƒ³åœ°å±•ç¤ºæ–°å†…å®¹ï¼Œè€Œä¸æ˜¯é‡å¤ç°æœ‰èµ„æºã€‚

## DETRç‰¹å®šçš„è¾“å‡º

[[autodoc]] models.detr.modeling_detr.DetrModelOutput

[[autodoc]] models.detr.modeling_detr.DetrObjectDetectionOutput

[[autodoc]] models.detr.modeling_detr.DetrSegmentationOutput

## DetrConfig

[[autodoc]] DetrConfig

## DetrImageProcessor

[[autodoc]] DetrImageProcessor
    - preprocess
    - post_process_object_detection
    - post_process_semantic_segmentation
    - post_process_instance_segmentation
    - post_process_panoptic_segmentation

## DetrFeatureExtractor

[[autodoc]] DetrFeatureExtractor
    - __call__
    - post_process_object_detection
    - post_process_semantic_segmentation
    - post_process_instance_segmentation
    - post_process_panoptic_segmentation

## DetrModel

[[autodoc]] DetrModel
    - forward

## DetrForObjectDetection

[[autodoc]] DetrForObjectDetection
    - forward

## DetrForSegmentation

[[autodoc]] DetrForSegmentation
    - forward