<!--Copyright 2022 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.

âš ï¸ Note that this file is in Markdown but contain specific syntax for our doc-builder (similar to MDX) that may not be
rendered properly in your Markdown viewer.

-->

# æ©ç è¯­è¨€å»ºæ¨¡

[[åœ¨Google Colabä¸­æ‰“å¼€]]

<Youtube id="mqElG5QJWUg"/>

æ©ç è¯­è¨€å»ºæ¨¡æ˜¯é¢„æµ‹åºåˆ—ä¸­æ©ç æ ‡è®°çš„ä»»åŠ¡ï¼Œæ¨¡å‹å¯ä»¥åŒå‘å…³æ³¨æ ‡è®°ã€‚è¿™æ„å‘³ç€æ¨¡å‹å¯ä»¥å®Œå…¨è®¿é—®å·¦å³ä¸¤ä¾§çš„æ ‡è®°ã€‚æ©ç è¯­è¨€å»ºæ¨¡é€‚ç”¨äºéœ€è¦å¯¹æ•´ä¸ªåºåˆ—å…·æœ‰è‰¯å¥½ä¸Šä¸‹æ–‡ç†è§£çš„ä»»åŠ¡ã€‚BERTå°±æ˜¯æ©ç è¯­è¨€æ¨¡å‹çš„ä¸€ä¸ªä¾‹å­ã€‚

æœ¬æŒ‡å—å°†å‘ä½ å±•ç¤ºå¦‚ä½•ï¼š

1. åœ¨ELI5æ•°æ®é›†çš„[r/askscience](https://www.reddit.com/r/askscience/)å­é›†ä¸Šå¾®è°ƒ[DistilRoBERTa](https://huggingface.co/distilroberta-base)ã€‚
2. ä½¿ç”¨å¾®è°ƒåçš„æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚

<Tip>
ä½ å¯ä»¥æŒ‰ç…§æœ¬æŒ‡å—çš„æ­¥éª¤å¾®è°ƒå…¶ä»–æ©ç è¯­è¨€æ¨¡å‹æ¶æ„ã€‚
é€‰æ‹©ä»¥ä¸‹æ¶æ„ä¹‹ä¸€ï¼š

<!--This tip is automatically generated by `make fix-copies`, do not fill manually!-->

[ALBERT](../model_doc/albert), [BART](../model_doc/bart), [BERT](../model_doc/bert), [BigBird](../model_doc/big_bird), [CamemBERT](../model_doc/camembert), [ConvBERT](../model_doc/convbert), [Data2VecText](../model_doc/data2vec-text), [DeBERTa](../model_doc/deberta), [DeBERTa-v2](../model_doc/deberta-v2), [DistilBERT](../model_doc/distilbert), [ELECTRA](../model_doc/electra), [ERNIE](../model_doc/ernie), [ESM](../model_doc/esm), [FlauBERT](../model_doc/flaubert), [FNet](../model_doc/fnet), [Funnel Transformer](../model_doc/funnel), [I-BERT](../model_doc/ibert), [LayoutLM](../model_doc/layoutlm), [Longformer](../model_doc/longformer), [LUKE](../model_doc/luke), [mBART](../model_doc/mbart), [MEGA](../model_doc/mega), [Megatron-BERT](../model_doc/megatron-bert), [MobileBERT](../model_doc/mobilebert), [MPNet](../model_doc/mpnet), [MRA](../model_doc/mra), [MVP](../model_doc/mvp), [Nezha](../model_doc/nezha), [NystrÃ¶mformer](../model_doc/nystromformer), [Perceiver](../model_doc/perceiver), [QDQBert](../model_doc/qdqbert), [Reformer](../model_doc/reformer), [RemBERT](../model_doc/rembert), [RoBERTa](../model_doc/roberta), [RoBERTa-PreLayerNorm](../model_doc/roberta-prelayernorm), [RoCBert](../model_doc/roc_bert), [RoFormer](../model_doc/roformer), [SqueezeBERT](../model_doc/squeezebert), [TAPAS](../model_doc/tapas), [Wav2Vec2](../model_doc/wav2vec2), [XLM](../model_doc/xlm), [XLM-RoBERTa](../model_doc/xlm-roberta), [XLM-RoBERTa-XL](../model_doc/xlm-roberta-xl), [X-MOD](../model_doc/xmod), [YOSO](../model_doc/yoso)

<!--End of the generated tip-->

</Tip>

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…è¦çš„åº“ï¼š

```bash
pip install transformers datasets evaluate
```

æˆ‘ä»¬é¼“åŠ±ä½ ç™»å½•Hugging Faceå¸æˆ·ï¼Œä»¥ä¾¿ä½ å¯ä»¥ä¸Šä¼ å’Œä¸ç¤¾åŒºå…±äº«ä½ çš„æ¨¡å‹ã€‚åœ¨æç¤ºæ—¶ï¼Œè¾“å…¥ä½ çš„tokenä»¥ç™»å½•ï¼š

```py
>>> from huggingface_hub import notebook_login

>>> notebook_login()
```

## åŠ è½½ELI5æ•°æ®é›†

é¦–å…ˆï¼Œä»ğŸ¤— Datasetsåº“ä¸­åŠ è½½ELI5æ•°æ®é›†ä¸­r/askscienceå­é›†çš„ä¸€ä¸ªè¾ƒå°å­é›†ã€‚è¿™å°†ç»™ä½ ä¸€ä¸ªæœºä¼šè¿›è¡Œå®éªŒï¼Œå¹¶ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œç„¶åå†èŠ±æ›´å¤šæ—¶é—´åœ¨å®Œæ•´æ•°æ®é›†ä¸Šè¿›è¡Œè®­ç»ƒã€‚

```py
>>> from datasets import load_dataset

>>> eli5 = load_dataset("eli5", split="train_asks[:5000]")
```

å°†æ•°æ®é›†çš„`train_asks`æ‹†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œä½¿ç”¨[`~datasets.Dataset.train_test_split`]æ–¹æ³•ï¼š

```py
>>> eli5 = eli5.train_test_split(test_size=0.2)
```

ç„¶åæŸ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š
```py
>>> eli5["train"][0]
{'answers': {'a_id': ['c3d1aib', 'c3d4lya'],
  'score': [6, 3],
  'text': ["The velocity needed to remain in orbit is equal to the square root of Newton's constant times the mass of earth divided by the distance from the center of the earth. I don't know the altitude of that specific mission, but they're usually around 300 km. That means he's going 7-8 km/s.\n\nIn space there are no other forces acting on either the shuttle or the guy, so they stay in the same position relative to each other. If he were to become unable to return to the ship, he would presumably run out of oxygen, or slowly fall into the atmosphere and burn up.",
   "Hope you don't mind me asking another question, but why aren't there any stars visible in this photo?"]},
 'answers_urls': {'url': []},
 'document': '',
 'q_id': 'nyxfp',
 'selftext': '_URL_0_\n\nThis was on the front page earlier and I have a few questions about it. Is it possible to calculate how fast the astronaut would be orbiting the earth? Also how does he stay close to the shuttle so that he can return safely, i.e is he orbiting at the same speed and can therefore stay next to it? And finally if his propulsion system failed, would he eventually re-enter the atmosphere and presumably die?',
 'selftext_urls': {'url': ['http://apod.nasa.gov/apod/image/1201/freeflyer_nasa_3000.jpg']},
 'subreddit': 'askscience',
 'title': 'Few questions about this space walk photograph.',
 'title_urls': {'url': []}}
 ```

è™½ç„¶è¿™çœ‹èµ·æ¥å¯èƒ½æœ‰ç‚¹å¤šï¼Œä½†ä½ å®é™…ä¸Šåªå¯¹`text`å­—æ®µæ„Ÿå…´è¶£ã€‚å…³äºè¯­è¨€å»ºæ¨¡ä»»åŠ¡çš„é…·ç‚«ä¹‹å¤„åœ¨äºä½ ä¸éœ€è¦æ ‡ç­¾ï¼ˆä¹Ÿç§°ä¸ºæ— ç›‘ç£ä»»åŠ¡ï¼‰ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªè¯å°±æ˜¯æ ‡ç­¾ã€‚

## é¢„å¤„ç†

<Youtube id="8PmhEIXhBvI"/>

å¯¹äºæ©ç è¯­è¨€å»ºæ¨¡ï¼Œä¸‹ä¸€æ­¥æ˜¯åŠ è½½ä¸€ä¸ªDistilRoBERTaåˆ†è¯å™¨æ¥å¤„ç†`text`å­å­—æ®µï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("distilroberta-base")
```

ä½ ä¼šæ³¨æ„åˆ°ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`text`å­—æ®µå®é™…ä¸Šæ˜¯åµŒå¥—åœ¨`answers`å†…çš„ã€‚è¿™æ„å‘³ç€ä½ éœ€è¦ä½¿ç”¨[`flatten`]æ–¹æ³•ä»å…¶åµŒå¥—ç»“æ„ä¸­æå–`text`å­å­—æ®µï¼š

```py
>>> eli5 = eli5.flatten()
>>> eli5["train"][0]
{'answers.a_id': ['c3d1aib', 'c3d4lya'],
 'answers.score': [6, 3],
 'answers.text': ["The velocity needed to remain in orbit is equal to the square root of Newton's constant times the mass of earth divided by the distance from the center of the earth. I don't know the altitude of that specific mission, but they're usually around 300 km. That means he's going 7-8 km/s.\n\nIn space there are no other forces acting on either the shuttle or the guy, so they stay in the same position relative to each other. If he were to become unable to return to the ship, he would presumably run out of oxygen, or slowly fall into the atmosphere and burn up.",
  "Hope you don't mind me asking another question, but why aren't there any stars visible in this photo?"],
 'answers_urls.url': [],
 'document': '',
 'q_id': 'nyxfp',
 'selftext': '_URL_0_\n\nThis was on the front page earlier and I have a few questions about it. Is it possible to calculate how fast the astronaut would be orbiting the earth? Also how does he stay close to the shuttle so that he can return safely, i.e is he orbiting at the same speed and can therefore stay next to it? And finally if his propulsion system failed, would he eventually re-enter the atmosphere and presumably die?',
 'selftext_urls.url': ['http://apod.nasa.gov/apod/image/1201/freeflyer_nasa_3000.jpg'],
 'subreddit': 'askscience',
 'title': 'Few questions about this space walk photograph.',
 'title_urls.url': []}
```

ç°åœ¨ï¼Œæ¯ä¸ªå­å­—æ®µéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„åˆ—ï¼Œå¦‚`answers`å‰ç¼€æ‰€ç¤ºï¼Œè€Œ`text`å­—æ®µç°åœ¨æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ä¸éœ€è¦å°†æ¯ä¸ªå¥å­åˆ†åˆ«æ ‡è®°åŒ–ï¼Œè€Œæ˜¯å°†åˆ—è¡¨è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä»¥ä¾¿å¯ä»¥è”åˆæ ‡è®°åŒ–å®ƒä»¬ã€‚

ä¸‹é¢æ˜¯ç¬¬ä¸€ä¸ªé¢„å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¯ä¸ªç¤ºä¾‹çš„å­—ç¬¦ä¸²åˆ—è¡¨è¿æ¥èµ·æ¥ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œæ ‡è®°åŒ–ï¼š

```py
>>> def preprocess_function(examples):
...     return tokenizer([" ".join(x) for x in examples["answers.text"]])
```

ä½¿ç”¨[`~datasets.Dataset.map`]æ–¹æ³•å°†æ­¤é¢„å¤„ç†å‡½æ•°åº”ç”¨äºæ•´ä¸ªæ•°æ®é›†ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®`batched=True`ä»¥ä¸€æ¬¡å¤„ç†æ•°æ®é›†çš„å¤šä¸ªå…ƒç´ ï¼Œå¹¶é€šè¿‡è®¾ç½®`num_proc`æ¥å¢åŠ è¿›ç¨‹æ•°ï¼Œä»¥åŠ å¿«`map`å‡½æ•°çš„é€Ÿåº¦ã€‚åˆ é™¤ä½ ä¸éœ€è¦çš„ä»»ä½•åˆ—ï¼š

```py
>>> tokenized_eli5 = eli5.map(
...     preprocess_function,
...     batched=True,
...     num_proc=4,
...     remove_columns=eli5["train"].column_names,
... )
```

è¯¥æ•°æ®é›†åŒ…å«æ ‡è®°åºåˆ—ï¼Œä½†å…¶ä¸­ä¸€äº›åºåˆ—æ¯”æ¨¡å‹çš„æœ€å¤§è¾“å…¥é•¿åº¦è¦é•¿ã€‚

ç°åœ¨ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªé¢„å¤„ç†å‡½æ•°ï¼š
- è¿æ¥æ‰€æœ‰åºåˆ—
- æ ¹æ®`block_size`å°†è¿æ¥åçš„åºåˆ—æ‹†åˆ†ä¸ºè¾ƒçŸ­çš„å—ï¼Œå…¶é•¿åº¦åº”å°äºæœ€å¤§è¾“å…¥é•¿åº¦ï¼Œå¹¶ä¸”è¶³å¤Ÿå°ï¼Œé€‚åº”ä½ çš„GPU RAMã€‚

```py
>>> block_size = 128

>>> def group_texts(examples):
...     # åˆå¹¶æ‰€æœ‰æ–‡æœ¬ã€‚
...     concatenated_examples = {k: sum(examples[k], []) for k in examples.keys()}
...     total_length = len(concatenated_examples[list(examples.keys())[0]])
...     # æˆ‘ä»¬èˆå¼ƒæ‰ä¸è¶³ä¸€ä¸ªblock_sizeçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å¡«å……ï¼Œè€Œä¸æ˜¯èˆå¼ƒï¼Œå‰ææ˜¯æ¨¡å‹æ”¯æŒå¡«å……ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ­¤éƒ¨åˆ†ã€‚
...     if total_length >= block_size:
...         total_length = (total_length // block_size) * block_size
...     # æŒ‰block_sizeåˆ’åˆ†ã€‚
...     result = {
...         k: [t[i : i + block_size] for i in range(0, total_length, block_size)]
...         for k, t in concatenated_examples.items()
...     }
...     return result
```

åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šåº”ç”¨`group_texts`å‡½æ•°ï¼š

```py
>>> lm_dataset = tokenized_eli5.map(group_texts, batched=True, num_proc=4)
```

ç°åœ¨ï¼Œä½¿ç”¨[`DataCollatorForLanguageModeling`]åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æ‰¹æ¬¡ã€‚åœ¨æ•´ä¸ªæ‰¹æ¬¡çš„æ•°æ®æ ¡å¯¹æœŸé—´ï¼Œ*åŠ¨æ€å¡«å……*å¥å­åˆ°æ‰¹æ¬¡ä¸­çš„æœ€é•¿é•¿åº¦æ¯”åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šå¡«å……åˆ°æœ€å¤§é•¿åº¦æ›´é«˜æ•ˆã€‚

<frameworkcontent>
<pt>

å°†åºåˆ—ç»“æŸæ ‡è®°ç”¨ä½œå¡«å……æ ‡è®°ï¼Œå¹¶æŒ‡å®š`mlm_probability`ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡è¿­ä»£æ•°æ®æ—¶éšæœºæ©ç æ ‡è®°ï¼š

```py
>>> from transformers import DataCollatorForLanguageModeling

>>> tokenizer.pad_token = tokenizer.eos_token
>>> data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=0.15)
```
</pt>
<tf>

å°†åºåˆ—ç»“æŸæ ‡è®°ç”¨ä½œå¡«å……æ ‡è®°ï¼Œå¹¶æŒ‡å®š`mlm_probability`ï¼Œä»¥ä¾¿åœ¨æ¯æ¬¡è¿­ä»£æ•°æ®æ—¶éšæœºæ©ç æ ‡è®°ï¼š

```py
>>> from transformers import DataCollatorForLanguageModeling

>>> data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=0.15, return_tensors="tf")
```
</tf>
</frameworkcontent>

## è®­ç»ƒ

<frameworkcontent>
<pt>
<Tip>

å¦‚æœä½ å¯¹ä½¿ç”¨[`Trainer`]å¾®è°ƒæ¨¡å‹ä¸å¤ªç†Ÿæ‚‰ï¼Œè¯·æŸ¥çœ‹[æ­¤å¤„](../training.md#train-with-pytorch-trainer)çš„åŸºæœ¬æ•™ç¨‹ã€‚

</Tip>

ä½ ç°åœ¨å¯ä»¥å¼€å§‹è®­ç»ƒæ¨¡å‹äº†ï¼ä½¿ç”¨[`AutoModelForMaskedLM`]åŠ è½½DistilRoBERTaï¼š
```py
>>> from transformers import AutoModelForMaskedLM

>>> model = AutoModelForMaskedLM.from_pretrained("distilroberta-base")
```

åªå‰©ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š

1. åœ¨[`TrainingArguments`]ä¸­å®šä¹‰ä½ çš„è®­ç»ƒè¶…å‚æ•°ã€‚ä»…éœ€è¦`output_dir`å‚æ•°ï¼ŒæŒ‡å®šä¿å­˜æ¨¡å‹çš„ä½ç½®ã€‚
2. å°†è®­ç»ƒå‚æ•°ä¸æ¨¡å‹ã€æ•°æ®é›†å’Œæ•°æ®æ ¡éªŒå™¨ä¸€èµ·ä¼ é€’ç»™[`Trainer`]ã€‚
3. è°ƒç”¨[`~Trainer.train`]è¿›è¡Œæ¨¡å‹å¾®è°ƒã€‚

```py
>>> training_args = TrainingArguments(
...     output_dir="my_awesome_eli5_mlm_model",
...     evaluation_strategy="epoch",
...     learning_rate=2e-5,
...     num_train_epochs=3,
...     weight_decay=0.01,
...     push_to_hub=True,
... )

>>> trainer = Trainer(
...     model=model,
...     args=training_args,
...     train_dataset=lm_dataset["train"],
...     eval_dataset=lm_dataset["test"],
...     data_collator=data_collator,
... )

>>> trainer.train()
```

å½“è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨[`~transformers.Trainer.evaluate`]æ–¹æ³•è¯„ä¼°æ¨¡å‹å¹¶è·å¾—æ¨¡å‹çš„å›°æƒ‘åº¦ï¼š

```py
>>> import math

>>> eval_results = trainer.evaluate()
>>> print(f"Perplexity: {math.exp(eval_results['eval_loss']):.2f}")
å°†ä½ çš„æ¨¡å‹å…±äº«åˆ°Hubä¸Šï¼Œä½¿ç”¨[`~transformers.Trainer.push_to_hub`]æ–¹æ³•ï¼Œè¿™æ ·æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨ä½ çš„æ¨¡å‹ï¼š

```py
>>> trainer.push_to_hub()
```
</pt>
<tf>
<Tip>

å¦‚æœä½ å¯¹ä½¿ç”¨Keraså¾®è°ƒæ¨¡å‹ä¸å¤ªç†Ÿæ‚‰ï¼Œè¯·æŸ¥çœ‹[æ­¤å¤„](../training.md#train-a-tensorflow-model-with-keras)çš„åŸºæœ¬æ•™ç¨‹ã€‚

</Tip>
è¦åœ¨TensorFlowä¸­å¾®è°ƒæ¨¡å‹ï¼Œè¯·é¦–å…ˆè®¾ç½®ä¼˜åŒ–å™¨å‡½æ•°ã€å­¦ä¹ ç‡è°ƒåº¦ç¨‹åºå’Œä¸€äº›è®­ç»ƒè¶…å‚æ•°ï¼š

```py
>>> from transformers import create_optimizer, AdamWeightDecay

>>> optimizer = AdamWeightDecay(learning_rate=2e-5, weight_decay_rate=0.01)
```

ç„¶åå¯ä»¥ä½¿ç”¨[`TFAutoModelForMaskedLM`]åŠ è½½DistilRoBERTaï¼š

```py
>>> from transformers import TFAutoModelForMaskedLM

>>> model = TFAutoModelForMaskedLM.from_pretrained("distilroberta-base")
```

ä½¿ç”¨[`~transformers.TFPreTrainedModel.prepare_tf_dataset`]å°†æ•°æ®é›†è½¬æ¢ä¸º`tf.data.Dataset`æ ¼å¼ï¼š

```py
>>> tf_train_set = model.prepare_tf_dataset(
...     lm_dataset["train"],
...     shuffle=True,
...     batch_size=16,
...     collate_fn=data_collator,
... )

>>> tf_test_set = model.prepare_tf_dataset(
...     lm_dataset["test"],
...     shuffle=False,
...     batch_size=16,
...     collate_fn=data_collator,
... )
```

ä½¿ç”¨[`compile`](https://keras.io/api/models/model_training_apis/#compile-method)ä¸ºæ¨¡å‹é…ç½®è®­ç»ƒã€‚è¯·æ³¨æ„ï¼ŒTransformersæ¨¡å‹éƒ½æœ‰é»˜è®¤çš„ä¸ä»»åŠ¡ç›¸å…³çš„æŸå¤±å‡½æ•°ï¼Œå› æ­¤é™¤éä½ æƒ³è¦æŒ‡å®šä¸€ä¸ªï¼Œå¦åˆ™ä¸éœ€è¦æŒ‡å®šï¼š

```py
>>> import tensorflow as tf

>>> model.compile(optimizer=optimizer)  # æ²¡æœ‰æŸå¤±å‚æ•°ï¼
```

å¯ä»¥é€šè¿‡åœ¨[`~transformers.PushToHubCallback`]ä¸­æŒ‡å®šè¦æ¨é€æ¨¡å‹å’Œåˆ†è¯å™¨çš„ä½ç½®æ¥å®ç°ï¼š

```py
>>> from transformers.keras_callbacks import PushToHubCallback

>>> callback = PushToHubCallback(
...     output_dir="my_awesome_eli5_mlm_model",
...     tokenizer=tokenizer,
... )
```
</tf>
</frameworkcontent>

æœ€åï¼Œä½ å¯ä»¥å¼€å§‹è®­ç»ƒæ¨¡å‹ï¼ä½¿ç”¨ä½ çš„è®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†ã€epochsçš„æ•°é‡ä»¥åŠä½ çš„å›è°ƒå‡½æ•°æ¥è°ƒç”¨[`fit`](https://keras.io/api/models/model_training_apis/#fit-method)æ–¹æ³•æ¥å¾®è°ƒæ¨¡å‹ï¼š

```py
>>> model.fit(x=tf_train_set, validation_data=tf_test_set, epochs=3, callbacks=[callback])
```

è®­ç»ƒå®Œæˆåï¼Œä½ çš„æ¨¡å‹ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°Hubï¼Œè¿™æ ·æ¯ä¸ªäººéƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼
</tf>
</frameworkcontent>

<Tip>

å¦‚æœä½ æƒ³è¦äº†è§£æ›´æ·±å…¥çš„å…³äºå¦‚ä½•å¯¹æ¨¡å‹è¿›è¡Œæ©ç è¯­è¨€å»ºæ¨¡å¾®è°ƒçš„ç¤ºä¾‹ï¼Œè¯·æŸ¥çœ‹ç›¸åº”çš„
[PyTorchç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/language_modeling.ipynb)
æˆ–[TensorFlowç¬”è®°æœ¬](https://colab.research.google.com/github/huggingface/notebooks/blob/main/examples/language_modeling-tf.ipynb)ã€‚

</Tip>

## æ¨æ–­

å¤ªå¥½äº†ï¼Œç°åœ¨ä½ å·²ç»å¯¹æ¨¡å‹è¿›è¡Œäº†å¾®è°ƒï¼Œå¯ä»¥ç”¨å®ƒè¿›è¡Œæ¨æ–­äº†ï¼

æƒ³å‡ºä¸€äº›ä½ å¸Œæœ›æ¨¡å‹å¡«è¡¥ç©ºç™½çš„æ–‡æœ¬ï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šçš„`<mask>`æ ‡è®°è¡¨ç¤ºç©ºç™½å¤„ï¼š

```py
>>> text = "The Milky Way is a <mask> galaxy."
```

å°è¯•ä½¿ç”¨å¾®è°ƒåçš„æ¨¡å‹è¿›è¡Œæ¨æ–­çš„æœ€ç®€å•æ–¹å¼æ˜¯å°†å…¶ç”¨äº[`pipeline`](https://huggingface.co/transformers/main_classes/pipelines.html#transformers.Pipeline)ä¸­ã€‚å®ä¾‹åŒ–ä¸€ä¸ªå¡«å……æ©ç çš„`pipeline`ï¼Œå°†æ¨¡å‹å’Œæ–‡æœ¬ä¼ é€’ç»™å®ƒã€‚å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥ä½¿ç”¨`top_k`å‚æ•°æŒ‡å®šè¦è¿”å›çš„é¢„æµ‹æ•°é‡ï¼š

```py
>>> from transformers import pipeline

>>> mask_filler = pipeline("fill-mask", "stevhliu/my_awesome_eli5_mlm_model")
>>> mask_filler(text, top_k=3)
[{'score': 0.5150994658470154,
  'token': 21300,
  'token_str': ' spiral',
  'sequence': 'The Milky Way is a spiral galaxy.'},
 {'score': 0.07087188959121704,
  'token': 2232,
  'token_str': ' massive',
  'sequence': 'The Milky Way is a massive galaxy.'},
 {'score': 0.06434620916843414,
  'token': 650,
  'token_str': ' small',
  'sequence': 'The Milky Way is a small galaxy.'}]
```

<frameworkcontent>
<pt>
å°†æ–‡æœ¬è¿›è¡Œæ ‡è®°åŒ–ï¼Œå¹¶è¿”å›PyTorchå¼ é‡ä½œä¸º`input_ids`ã€‚ä½ è¿˜éœ€è¦æŒ‡å®š`<mask>`æ ‡è®°çš„ä½ç½®ï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> inputs = tokenizer(text, return_tensors="pt")
>>> mask_token_index = torch.where(inputs["input_ids"] == tokenizer.mask_token_id)[1]
```

å°†è¾“å…¥ä¼ é€’ç»™æ¨¡å‹ï¼Œå¹¶è¿”å›æ©ç æ ‡è®°çš„`logits`ï¼š

```py
>>> from transformers import AutoModelForMaskedLM

>>> model = AutoModelForMaskedLM.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> logits = model(**inputs).logits
>>> mask_token_logits = logits[0, mask_token_index, :]
```

ç„¶åè¿”å›å…·æœ‰æœ€é«˜æ¦‚ç‡çš„ä¸‰ä¸ªæ©ç æ ‡è®°å¹¶å°†å…¶æ‰“å°å‡ºæ¥ï¼š

```py
>>> top_3_tokens = torch.topk(mask_token_logits, 3, dim=1).indices[0].tolist()

>>> for token in top_3_tokens:
...     print(text.replace(tokenizer.mask_token, tokenizer.decode([token])))
The Milky Way is a spiral galaxy.
The Milky Way is a massive galaxy.
The Milky Way is a small galaxy.
```
</pt>
<tf>
å°†æ–‡æœ¬è¿›è¡Œæ ‡è®°åŒ–ï¼Œå¹¶è¿”å›TensorFlowå¼ é‡ä½œä¸º`input_ids`ã€‚ä½ è¿˜éœ€è¦æŒ‡å®š`<mask>`æ ‡è®°çš„ä½ç½®ï¼š

```py
>>> from transformers import AutoTokenizer

>>> tokenizer = AutoTokenizer.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> inputs = tokenizer(text, return_tensors="tf")
>>> mask_token_index = tf.where(inputs["input_ids"] == tokenizer.mask_token_id)[0, 1]
```

å°†è¾“å…¥ä¼ é€’ç»™æ¨¡å‹ï¼Œå¹¶è¿”å›æ©ç æ ‡è®°çš„`logits`ï¼š

```py
>>> from transformers import TFAutoModelForMaskedLM

>>> model = TFAutoModelForMaskedLM.from_pretrained("stevhliu/my_awesome_eli5_mlm_model")
>>> logits = model(**inputs).logits
>>> mask_token_logits = logits[0, mask_token_index, :]
```

ç„¶åè¿”å›å…·æœ‰æœ€é«˜æ¦‚ç‡çš„ä¸‰ä¸ªæ©ç æ ‡è®°å¹¶å°†å…¶æ‰“å°å‡ºæ¥ï¼š

```py
>>> top_3_tokens = tf.math.top_k(mask_token_logits, 3).indices.numpy()

>>> for token in top_3_tokens:
...     print(text.replace(tokenizer.mask_token, tokenizer.decode([token])))
The Milky Way is a spiral galaxy.
The Milky Way is a massive galaxy.
The Milky Way is a small galaxy.
```
</tf>
</frameworkcontent>